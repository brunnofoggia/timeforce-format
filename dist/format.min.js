import _ from"lodash";import{format as formatFn,formatMoment}from"format-99xp";var format={Model:{},Collection:{}};format.Model._format=formatFn,format.Collection._format=formatFn,format.Model.format={},format.Model.formatMe=function(t=formatMoment.FROMREMOTE){this.attributes=this.formatData(this.attributes,{},t)},format.Model.formatCopy=function(t,o=formatMoment.FROMREMOTE){return this.formatData(_.cloneDeep(t||this.attributes),{},o)},format.Model.formatData=function(t,o,a=formatMoment.FROMREMOTE){var r,e=_.result(this,"format");if(t&&"format"in this&&"object"==typeof e&&_.size(e)>0)for(r in e){let e,f=/\w+\[/.test(r)?r.replace(/^(\w+\.)\d+/,"$1."):r;/\.\d*\./.test(f)||(f=/\.\w+\.\d+/.test(f)?f.replace(/\.(\w+\.)\d+/,".$1."):f,e=[f]);for(let r in e){let m=e[r];t=this.formatDataItem(m,a,f,t,o)}}return t},format.Model.formatDataItem=function(t,o=formatMoment.FROMREMOTE,a,r){var e=_.result(this,"format");void 0===r&&(r=_.cloneDeep(this.attributes)),!a&&(a=t);var f=e[a];!_.isArray(f)&&(f=[f]);for(let a of f){var m=this.formatItem(t,o,r,a);void 0!==m&&(r=this.formSetTreeVal(t,m,r))}return r},format.Model.formatItem=function(t,o,a,r){var e=_.result(this,"format");void 0===a&&(a=_.cloneDeep(this.attributes)),void 0===r&&(r=e[t]),"function"==typeof r&&(r=_.bind(r,this));var f=this.getDataByPath(t,a);return void 0!==f&&(f=formatFn(f,r,o)),f},format.Model.parse=function(t,o){return"function"==typeof this.formatData&&(t=this.formatData(t,o,formatMoment.FROMREMOTE)),t},format.Model.toJSON=function(t={}){var o=this.getJSONtoFormat(t);return"function"==typeof this.formatData&&(o=this.formatData(o,t,formatMoment.TOREMOTE)),o},format.Model.getJSONtoFormat=function(t={}){return _.cloneDeep(t?.data||this.attributes)},format.Model.getDataByPath=function(path,attrs,defaultVal){var val=defaultVal;return eval(`try { val = attrs.${path}; } catch(e) { }`),val},format.Model.formSetTree=function(t,o){var a=t.split("."),r=[];for(var e in a)r.push(a[e]),this.formSetTreeObj(r.join("."),o);return o},format.Model.formSetTreeObj=function(path,attrs){var value=this.getDataByPath(path,attrs);return void 0===value&&eval(`attrs.${path} = {};`),attrs},format.Model.formSetTreeVal=function(path,val="",attrs){return attrs=this.formSetTree(path,attrs),"string"==typeof val&&(val=`'${val}'`),"object"==typeof val&&(val=JSON.stringify(val)),eval(`attrs.${path} = ${val}`),attrs},format.Collection.formatModels=function(){if(this.models)for(let t of this.models)t.formatMe()},format.Collection.unformatModels=function(){if(this.models)for(let t of this.models)t.unformatMe(formatMoment.TOREMOTE)};var mix=function(t,o){_.each([[t,format.Collection],[o,format.Model]],(function(t){var o=t[0],a=t[1];_.each(a,(function(t,a){o.prototype[a]=t}))}))};export{mix};